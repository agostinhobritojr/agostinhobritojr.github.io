<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Cap&iacute;tulo 5. Desenvolvendo aplica&ccedil;&otilde;es para Web.</title><link rel="stylesheet" type="text/css" href="estilo.css"><meta name="generator" content="DocBook XSL Stylesheets V1.78.1"><link rel="home" href="index.html" title="Introdu&ccedil;&atilde;o &agrave; programa&ccedil;&atilde;o em Qt"><link rel="up" href="index.html" title="Introdu&ccedil;&atilde;o &agrave; programa&ccedil;&atilde;o em Qt"><link rel="prev" href="cha.fontesAnimacao.html" title="Cap&iacute;tulo 4. Fontes e anima&ccedil;&otilde;es aos Programas."><meta xmlns:fo="http://www.w3.org/1999/XSL/Format" http-equiv="Content-Type" content="text/html; charset=utf-8"><script xmlns:fo="http://www.w3.org/1999/XSL/Format" type="text/x-mathjax-config">
    MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
    tex2jax: {inlineMath: [["$","$"],["\\(","\\)"]]}
    });
  </script><script xmlns:fo="http://www.w3.org/1999/XSL/Format" type="text/javascript" src="http://www.dca.ufrn.br/~ambj/mathjax/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Cap&iacute;tulo 5. Desenvolvendo aplica&ccedil;&otilde;es para Web.</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="cha.fontesAnimacao.html">Anterior</a>&nbsp;</td><th width="60%" align="center">&nbsp;</th><td width="20%" align="right">&nbsp;</td></tr></table><hr></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="cha.aplicacaoWeb"></a>Cap&iacute;tulo 5. Desenvolvendo aplica&ccedil;&otilde;es para Web.</h1></div></div></div><div class="toc"><p><b>&Iacute;ndice</b></p><dl class="toc"><dt><span class="sect1"><a href="cha.aplicacaoWeb.html#sec1.aplicacaoWeb.conhecendoMusicBrainz">5.1. Conhecendo o MusicBrainz</a></span></dt><dt><span class="sect1"><a href="cha.aplicacaoWeb.html#sec1.aplicacaoWeb.instalacoesPrevias">5.2. Requisitos Iniciais</a></span></dt><dt><span class="sect1"><a href="cha.aplicacaoWeb.html#sec1.aplicacaoWeb.moduloCoverArt">5.3. M&oacute;dulo <span class="foreignphrase"><em class="foreignphrase">Cover Art</em></span></a></span></dt><dt><span class="sect1"><a href="cha.aplicacaoWeb.html#sec1.aplicacaoWeb.moduloRSS">5.4. M&oacute;dulo <acronym class="acronym">RSS</acronym></a></span></dt></dl></div>
    

    <p>Neste cap&iacute;tulo desenvolveremos ferramentas que ir&atilde;o acessar a internet para dar novas funcionalidades ao nosso <span class="foreignphrase"><em class="foreignphrase">player</em></span>. O objetivo &eacute; dar uma base de como desenvolver aplica&ccedil;&otilde;es que se utilizam de requisi&ccedil;&otilde;es na rede mundial de computadores.</p>
    <div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sec1.aplicacaoWeb.conhecendoMusicBrainz"></a>5.1. Conhecendo o MusicBrainz</h2></div></div></div>
      
      <p>O MusicBrainz &eacute; um banco de dados aberto que armazena informa&ccedil;&otilde;es da &aacute;rea musical. Atrav&eacute;s dele podemos obter informa&ccedil;&otilde;es como lista de m&uacute;sicas de um certo &aacute;lbum, informa&ccedil;&otilde;es de um artista e muitos outros dados.</p> 
      <p>Muitas aplica&ccedil;&otilde;es se utilizam do banco de dados do MusicBrainz para gerar informa&ccedil;&otilde;es sobre arquivos de &aacute;udios ou similares. De forma an&aacute;loga iremos utilizar tal banco de dados para obter o <span class="foreignphrase"><em class="foreignphrase">cover art</em></span> de algum CD especificado.</p>
      <p>Para mais informa&ccedil;&otilde;es sobre esta enciclop&eacute;dia acesse: <a class="ulink" href="https://musicbrainz.org/" target="_top">MusicBrainz</a></p>
    </div>

    <div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sec1.aplicacaoWeb.instalacoesPrevias"></a>5.2. Requisitos Iniciais</h2></div></div></div>
      
      <p>Para desenvolver as ferramentas das pr&oacute;ximas se&ccedil;&otilde;es &eacute; necess&aacute;rio possuir alguns pacotes instalados no seu computador, s&atilde;o pacotes referentes ao MusicBrainz.</p>
      <p>Primeiramente devemos instalar o pacote <span class="package">libneon27-gnults-dev</span> utilizando o seguinte comando:</p>
      <pre class="screen"><span class="command"><strong>sudo apt-get install</strong></span> <span class="package">libneon27-gnults-dev</span></pre>
      <p>Em seguida ser&aacute; necess&aacute;rio instalar o pacote <span class="package">libjansson-dev</span>, veja o comando:</p>
      <pre class="screen"><span class="command"><strong>sudo apt-get install</strong></span> <span class="package">libjansson-dev</span></pre>
      <div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Nota]" src="images/note.png"></td><th align="left">Nota</th></tr><tr><td align="left" valign="top"><p>Vale salientar que as ferramentas ser&atilde;o desenvolvidas para Linux, i. e., os pacotes aqui citados e tudo mais a frente ser&aacute; referente ao uso em qualquer distribui&ccedil;&atilde;o Linux.</p></td></tr></table></div>
      <div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Nota]" src="images/note.png"></td><th align="left">Nota</th></tr><tr><td align="left" valign="top"><p>Os pacotes tamb&eacute;m podem ser instalados atrav&eacute;s da central de programas, basta pesquisar pelos nomes dos pacotes e instalar.</p></td></tr></table></div>

      <p>Ap&oacute;s ter instalado todos os pacotes anteriormente citados &eacute; poss&iacute;vel instalar o <span class="package">libcoverart</span>, uma biblioteca C/C++ que permite o desenvolvedor implementar a capacidade de obter <span class="foreignphrase"><em class="foreignphrase">cover art</em></span> do MusicBrainz a sua aplica&ccedil;&atilde;o. No s&iacute;tio oficial do MusicBrainz podemos obter tal biblioteca (<a class="ulink" href="https://wiki.musicbrainz.org/libcoverart" target="_top">libcoverart</a>). Baixe o arquivo comprimido.</p>
      <p>Ao finalizar o <span class="foreignphrase"><em class="foreignphrase">download</em></span> descompacte-o e, atrav&eacute;s do <span class="foreignphrase"><em class="foreignphrase">prompt</em></span> de comando, v&aacute; ao diret&oacute;rio rec&eacute;m descompactado. Execute os seguintes comandos:</p>
      <pre class="screen">
cmake -DCMAKE_INSTALL_PREFIX:PATH=/usr .
make
make install</pre>
      <p>Ao fim deste processo a biblioteca dever&aacute; estar instalada com sucesso, para verificar isto basta acessar o diret&oacute;rio <code class="filename">/usr/include/coverart/</code> e l&aacute; estar&aacute; todos os arquivo <code class="filename">.h</code> da biblioteca.</p>
      <p>Com tudo instalado &eacute; poss&iacute;vel utilizar as fun&ccedil;&otilde;es oferecidas pela biblioteca <span class="package">coverart</span>. Sendo necess&aacute;rio incluir as classes na sua aplica&ccedil;&atilde;o da seguinte forma:</p>
      <p>No arquivo <code class="filename">.pro</code></p>
      <pre class="screen">unix|win32: LIBS += -lcoverart</pre>
      <p>No arquivo <code class="filename">.cpp</code> ou <code class="filename">.h</code></p>
      <pre class="screen">#include <span class="quote">&#8220;<span class="quote">coverart/classe.h</span>&#8221;</span></pre>      
      <p>Onde a <code class="code">classe.h</code> s&atilde;o as classes definidas pela documenta&ccedil;&atilde;o da biblioteca (<a class="ulink" href="http://metabrainz.github.io/libcoverart/1.0.0/" target="_top">documenta&ccedil;&atilde;o</a>).</p>      
    </div>  
      
  
    <div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sec1.aplicacaoWeb.moduloCoverArt"></a>5.3. M&oacute;dulo <span class="foreignphrase"><em class="foreignphrase">Cover Art</em></span></h2></div></div></div>
      
      <p>Com este m&oacute;dulo poderemos executar buscas de <span class="foreignphrase"><em class="foreignphrase">cover art</em></span> na internet. O objetivo &eacute; desenvolver um ferramenta independente onde o desenvolvedor ao utiliza-la s&oacute; precisar&aacute; chamar Signals/Slots do mesmo para obter os resultados desejados.</p>
      <p>O m&oacute;dulo <span class="foreignphrase"><em class="foreignphrase">Cover Art</em></span> tem apenas um Slot que &eacute; a via por onde o desenvolvedor poder&aacute; passar o nome do artista e o nome da m&uacute;sica que deseja o <span class="foreignphrase"><em class="foreignphrase">cover art</em></span>. Desta forma o m&oacute;dulo automaticamente ir&aacute; iniciar a pesquisa e retornar a imagem ou alguma mensagem de erro durante a busca.</p>
      
      
      <div class="figure"><a name="fig.aplicacaoWeb.moduloCoverArt.diagrama"></a><p class="title"><b>Figura 5.1. Diagrama do m&oacute;dulo <span class="foreignphrase"><em class="foreignphrase">Cover Art</em></span>.</b></p><div class="figure-contents">
	
	<div class="mediaobject"><div xmlns:fo="http://www.w3.org/1999/XSL/Format" class="graphic"><object type="image/svg+xml" data="figuras/capitulo5/coverart_diagrama.svg">figuras/capitulo5/coverart_diagrama.svg</object></div></div>
      </div></div><br class="figure-break">

      <p>Segue o link para download do m&oacute;dulo <span class="foreignphrase"><em class="foreignphrase">Cover Art</em></span>: <a class="ulink" href="exemplos/moduloCoverArt.zip" target="_top">Download</a></p>
      <p>Segue o link para download de um exemplo de projeto que se utiliza do nosso novo m&oacute;dulo: <a class="ulink" href="exemplos/programa_moduloCoverArt.zip" target="_top">Download</a></p> 
      <p>Para utilizar o m&oacute;dulo &eacute; necess&aacute;rio adicionar algumas informa&ccedil;&otilde;es ao arquivo <code class="filename">.pro</code> do projeto, estas informa&ccedil;&otilde;es s&atilde;o necess&aacute;rias pois o m&oacute;dulo se utiliza delas internamente.</p>
      <p>A seguir, veja o que foi necess&aacute;rio adicionar ao arquivo <code class="filename">.pro</code></p>
      <pre class="screen">
QT       += core gui network
...
unix|win32: LIBS += -lcoverart</pre>
      <p>Na primeira modifica&ccedil;&atilde;o adicionamos o termo <strong class="userinput"><code>network</code></strong> que notifica ao compilador que ser&atilde;o utilizados funcionalidade de internet na aplica&ccedil;&atilde;o, no nosso caso o termo se enquadra pois teremos que fazer requisi&ccedil;&otilde;es HTTP na internet.</p>
      <p>A segunda modifica&ccedil;&atilde;o &eacute; necess&aacute;ria para notificar ao compilador que iremos utilizar a biblioteca <span class="package">coverart</span>. &Eacute; necess&aacute;rio que ela j&aacute; esteja instalada no computador.</p>
      <p>Na implementa&ccedil;&atilde;o do m&oacute;dulo utilizamos a classe <code class="classname">QNetworkAccessManager</code> para gerenciar as requisi&ccedil;&otilde;es na <span class="foreignphrase"><em class="foreignphrase">web</em></span>, perceba que no construtor do m&oacute;dulo iniciamos tal gerenciador e logo em seguida conectamos o seu Signal <code class="function">finished()</code> (executado quando a requisi&ccedil;&atilde;o &eacute; finalizada) a uma fun&ccedil;&atilde;o Slot <code class="function">resposta()</code> do m&oacute;dulo.</p>
      <pre class="screen">
manager = <strong class="hl-keyword">new</strong> QNetworkAccessManager(<strong class="hl-keyword">this</strong>);
connect(manager,SIGNAL(finished(QNetworkReply*)),<strong class="hl-keyword">this</strong>,SLOT(resposta(QNetworkReply*)));</pre>
      <p>Quando o desenvolvedor executa externamente o Slot <code class="function">atualizaCoverArt()</code> o m&oacute;dulo gera uma URL, tal URL cont&eacute;m o nome da m&uacute;sica e o nome do artista passados por par&acirc;metro.</p>
      <div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Nota]" src="images/note.png"></td><th align="left">Nota</th></tr><tr><td align="left" valign="top"><p>A estrutura da URL foi criada com base no tutorial da MusicBrainz, nele s&atilde;o especificados as formas de requisi&ccedil;&otilde;es no <span class="foreignphrase"><em class="foreignphrase">web service</em></span> da enciclop&eacute;dia. Mais informa&ccedil;&otilde;es <a class="ulink" href="https://musicbrainz.org/doc/Development/XML_Web_Service/Version_2" target="_top">aqui</a>.</p></td></tr></table></div>
      <pre class="screen">
QString urlBase = <span class="quote">&#8220;<span class="quote">https://musicbrainz.org/ws/2/recording?query=recording:\""+nome_da_musica+"\"+artist:\""+nome_do_artista+"\"&amp;limit=1</span>&#8221;</span>;    
manager-&gt;get(QNetworkRequest(QUrl(urlBase)));</pre>
      <p>Com a URL constru&iacute;da, utilizamos o gerenciador de rede <code class="varname">manager</code> para executar a requisi&ccedil;&atilde;o. O resultado da requisi&ccedil;&atilde;o &eacute; tratado no Slot <code class="function">resposta()</code>.</p>
      <p>Ao ser executado o Slot <code class="function">resposta()</code> &eacute; feito um tratamento para casos de erros e em seguida, caso esteja tudo como esperado, &eacute; obtido o identificador do <span class="foreignphrase"><em class="foreignphrase"> cover art</em></span> atrav&eacute;s do m&eacute;todo <code class="function">obterReleaseID()</code>. Este m&eacute;todo resumidamente percorre toda a resposta gerada pelo <span class="foreignphrase"><em class="foreignphrase">web service</em></span> procurando pela tag <code class="varname">release</code> para ent&atilde;o retornar o valor do identificador.</p>
      <div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Nota]" src="images/note.png"></td><th align="left">Nota</th></tr><tr><td align="left" valign="top"><p>A resposta do <span class="foreignphrase"><em class="foreignphrase">web service</em></span> da MusicBrainz &eacute; um arquivo em XML com as informa&ccedil;&otilde;es geradas da pesquisa.</p></td></tr></table></div>
      <p>Com o identificador encontrado o m&eacute;todo <code class="function">obterCoverArt()</code> &eacute; executado, nele &eacute; utilizado a biblioteca <span class="package">coverart</span>. Est&aacute; biblioteca possibilita que seja obtida o <span class="foreignphrase"><em class="foreignphrase">cover art</em></span> frontal de algum CD determinado pelo identificador (chamado tamb&eacute;m de MBID, <a class="ulink" href="https://musicbrainz.org/doc/MusicBrainz_Identifier" target="_top">MusicBrainzID</a>). Desta forma, como j&aacute; temos o identificador, fica necess&aacute;rio executar o m&eacute;todo <code class="function">FetchFront()</code> da biblioteca e teremos o <span class="foreignphrase"><em class="foreignphrase">cover art</em></span> desejado.</p>
      <pre class="screen">
CoverArtArchive::CCoverArt my_cover(<span class="quote">&#8220;<span class="quote">moduloCoverArt</span>&#8221;</span>);
std::vector&lt;<strong class="hl-keyword">unsigned</strong> <strong class="hl-keyword">char</strong>&gt; Imagem = my_cover.FetchFront(releaseID.toStdString());</pre>
      
      <div class="figure"><a name="fig.aplicacaoWeb.moduloCoverArt.execucao"></a><p class="title"><b>Figura 5.2. Exemplo de utiliza&ccedil;&atilde;o do m&oacute;dulo <span class="foreignphrase"><em class="foreignphrase">Cover Art</em></span>.</b></p><div class="figure-contents">
	
	<div class="mediaobject"><div xmlns:fo="http://www.w3.org/1999/XSL/Format" class="graphic"><object type="image/svg+xml" data="figuras/capitulo5/coverart_execucao.svg">figuras/capitulo5/coverart_execucao.svg</object></div></div>
      </div></div><br class="figure-break">
    </div>

    <div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sec1.aplicacaoWeb.moduloRSS"></a>5.4. M&oacute;dulo <acronym class="acronym">RSS</acronym></h2></div></div></div>
      
      
      <p>Com este m&oacute;dulo poderemos dar ao nosso <span class="foreignphrase"><em class="foreignphrase">player</em></span> um assinante RSS de forma que ser&aacute; poss&iacute;vel ler not&iacute;cias de sites sobre m&uacute;sica pelo nosso software. O objetivo &eacute; desenvolver uma ferramenta independente onde o desenvolvedor ao utiliza-la s&oacute; precisar&aacute; chamar Signals/Slots do mesmo para obter os resultados desejados.</p> 

      <p>O m&oacute;dulo RSS possui apenas um Slot que &eacute; utilizada para atualizar as not&iacute;cias do m&oacute;dulo. O m&oacute;dulo ir&aacute; pesquisar pelas primeiras not&iacute;cias do site e ent&atilde;o ir&aacute; exibir em forma de <span class="foreignphrase"><em class="foreignphrase">link</em></span> clic&aacute;vel.</p>

      
      <div class="figure"><a name="fig.aplicacaoWeb.moduloRSS.diagrama"></a><p class="title"><b>Figura 5.3. Diagrama do m&oacute;dulo RSS.</b></p><div class="figure-contents">
	
	<div class="mediaobject"><div xmlns:fo="http://www.w3.org/1999/XSL/Format" class="graphic"><object type="image/svg+xml" data="figuras/capitulo5/rss_diagrama.svg">figuras/capitulo5/rss_diagrama.svg</object></div></div>
      </div></div><br class="figure-break">

      <p>Segue o link para download do m&oacute;dulo RSS: <a class="ulink" href="exemplos/moduloRSS.zip" target="_top">Download</a></p>
      <p>Segue o link para download de um exemplo que se utiliza do nosso novo m&oacute;dulo: <a class="ulink" href="exemplos/programa_moduloRSS.zip" target="_top">Download</a></p>

      <p>Para utilizar o m&oacute;dulo &eacute; necess&aacute;rio adicionar algumas informa&ccedil;&otilde;es ao arquivo <code class="filename">.pro</code> do projeto, estas informa&ccedil;&otilde;es s&atilde;o necess&aacute;rias pois o m&oacute;dulo se utiliza delas internamente.</p>
      <p>A seguir, veja o que foi necess&aacute;rio adicionar ao arquivo <code class="filename">.pro</code></p>
      <pre class="screen">QT       += core gui network</pre>
      <p>Na modifica&ccedil;&atilde;o adicionamos o termo <strong class="userinput"><code>network</code></strong> que notifica ao compilador que ser&atilde;o utilizados funcionalidade de internet na aplica&ccedil;&atilde;o, no nosso caso o termo se enquadra pois teremos que fazer requisi&ccedil;&otilde;es HTTP na internet.</p>
      <p>O m&oacute;dulo RSS se utiliza da mesma estrat&eacute;gia implementada no m&oacute;dulo <span class="foreignphrase"><em class="foreignphrase">Cover Art</em></span>, utilizamos a classe <code class="classname">QNetworkAccessManager</code> para gerenciar as requisi&ccedil;&otilde;es na <span class="foreignphrase"><em class="foreignphrase">web</em></span> e assim obter o arquivo XML do site RSS. Com o arquivo XML percorremos as <span class="foreignphrase"><em class="foreignphrase">tags</em></span> identificando os t&iacute;tulos das not&iacute;cias e os seus respectivos links.</p>
      <p>Primeiramente iniciamos o <code class="varname">manager</code> para fazer as requisi&ccedil;&otilde;es na <span class="foreignphrase"><em class="foreignphrase">web</em></span>.</p>
      <pre class="screen">manager = <strong class="hl-keyword">new</strong> QNetworkAccessManager(<strong class="hl-keyword">this</strong>);
connect(manager, SIGNAL(finished(QNetworkReply*)),<strong class="hl-keyword">this</strong>, SLOT(replyFinished(QNetworkReply*)));</pre>
      <p>O Slot <code class="function">replyFinished()</code> &eacute; executado quando uma requisi&ccedil;&atilde;o &eacute; finalizada, neste m&eacute;todo verificamos se n&atilde;o ocorreram erros e ent&atilde;o capturamos os dados em XML para iniciar o tratamento pelo m&eacute;todo <code class="function">tratarXmlParaLabel()</code>.</p>
      <pre class="screen"><strong class="hl-keyword">if</strong>(networkReply-&gt;error() == QNetworkReply::NoError){
      QByteArray byteArray = networkReply-&gt;readAll();
      QXmlStreamReader* xml = <strong class="hl-keyword">new</strong> QXmlStreamReader(byteArray);
      trataXmlParaLabel(xml);
}</pre>
      <p>Durante o tratamento seguimos um padr&atilde;o de arquivos XML vindouros de RSS, para cada site h&aacute; uma forma distinta de percorrer o arquivo XML, no nosso exemplo seguiremos o padr&atilde;o do <a class="ulink" href="http://www.cifraclubnews.com.br/" target="_top">Cifra Club News</a> para capturar as not&iacute;cias.</p>
      <p>Por fim, o m&oacute;dulo exibe as not&iacute;cias e refaz todo o procedimento sempre que o Slot <code class="function">atualizar()</code> &eacute; executado.</p>
      
      <div class="figure"><a name="fig.aplicacaoWeb.moduloRSS.execucao"></a><p class="title"><b>Figura 5.4. Exemplo de utiliza&ccedil;&atilde;o do m&oacute;dulo RSS.</b></p><div class="figure-contents">
	
	<div class="mediaobject"><div xmlns:fo="http://www.w3.org/1999/XSL/Format" class="graphic"><object type="image/svg+xml" data="figuras/capitulo5/rss_execucao.svg">figuras/capitulo5/rss_execucao.svg</object></div></div>
      </div></div><br class="figure-break">
    </div>

  </div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="cha.fontesAnimacao.html">Anterior</a>&nbsp;</td><td width="20%" align="center">&nbsp;</td><td width="40%" align="right">&nbsp;</td></tr><tr><td width="40%" align="left" valign="top">Cap&iacute;tulo 4. Fontes e anima&ccedil;&otilde;es aos Programas.&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Principal</a></td><td width="40%" align="right" valign="top">&nbsp;</td></tr></table></div><div xmlns:fo="http://www.w3.org/1999/XSL/Format" class="navheader"><hr><table width="100%"><tr><td align="center"><p class="copyright">Copyright &copy; 2014 Tiago Fernandes</p></td></tr></table></div></body></html>